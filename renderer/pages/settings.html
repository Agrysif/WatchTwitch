<div class="settings-page">
  <div class="page-header">
    <h1 class="page-title" data-i18n="settings.title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h1>
    <p class="page-subtitle" data-i18n="settings.subtitle">–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</p>
  </div>

  <!-- General Settings -->
  <div class="card">
    <h3 class="settings-section-title">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" style="margin-right: 8px; display: inline-block; vertical-align: -4px; color: var(--accent-color);">
        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
      </svg>
      <span data-i18n="settings.general">–û–±—â–∏–µ</span>
    </h3>
    
    <div class="setting-item">
      <div class="setting-info">
        <div class="setting-label">–Ø–∑—ã–∫</div>
        <div class="setting-description">Choose your preferred language</div>
      </div>
      <div style="flex-shrink: 0; margin-left: auto;">
        <select class="input-field" id="language-select" style="width: 200px;">
          <option value="ru">–†—É—Å—Å–∫–∏–π</option>
          <option value="en">English</option>
        </select>
      </div>
    </div>

    <div class="setting-item">
      <div class="setting-info">
        <div class="setting-label">–¢–µ–º–∞</div>
        <div class="setting-description">Switch between dark and light theme</div>
      </div>
      <div style="flex-shrink: 0; margin-left: auto;">
        <select class="input-field" id="theme-select" style="width: 200px;">
          <option value="dark">–¢–µ–º–Ω–∞—è</option>
          <option value="light">–°–≤–µ—Ç–ª–∞—è</option>
        </select>
      </div>
    </div>

    <div class="setting-item">
      <div class="setting-info">
        <div class="setting-label" data-i18n="settings.autostart">–ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ Windows</div>
        <div class="setting-description">Launch WatchTwitch when Windows starts</div>
      </div>
      <label class="settings-toggle" for="autostart-toggle">
        <input type="checkbox" id="autostart-toggle">
        <span class="settings-slider"></span>
      </label>
    </div>
  </div>

  <!-- Notifications Settings -->
  <div class="card">
    <h3 class="settings-section-title">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" style="margin-right: 8px; display: inline-block; vertical-align: -4px; color: #FFB020;">
        <path d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.89 2 2 2zm6-6v-5c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2z"/>
      </svg>
      <span data-i18n="settings.notifications">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</span>
    </h3>
    
    <div class="setting-item">
      <div class="setting-info">
        <div class="setting-label" data-i18n="settings.enableNotifications">–í–∫–ª—é—á–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</div>
        <div class="setting-description">Show notifications for drops and events</div>
      </div>
      <label class="settings-toggle" for="notifications-toggle">
        <input type="checkbox" id="notifications-toggle" checked>
        <span class="settings-slider"></span>
      </label>
    </div>

    <div class="setting-item">
      <div class="setting-info">
        <div class="setting-label" data-i18n="settings.soundAlerts">–ó–≤—É–∫–æ–≤—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</div>
        <div class="setting-description">Play sound when drops are completed</div>
      </div>
      <label class="settings-toggle" for="sound-toggle">
        <input type="checkbox" id="sound-toggle" checked>
        <span class="settings-slider"></span>
      </label>
    </div>
  </div>

  <!-- Farming Settings -->
  <div class="card">
    <h3 class="settings-section-title">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" style="margin-right: 8px; display: inline-block; vertical-align: -4px; color: #00E57A;">
        <path d="M12 2L2 7v10c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V7l-10-5z"/>
      </svg>
      <span data-i18n="settings.farming">–§–∞—Ä–º–∏–Ω–≥</span>
    </h3>
    
    <div class="setting-item">
      <div class="setting-info">
        <div class="setting-label" data-i18n="settings.streamQuality">–ö–∞—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–∏–º–∞</div>
        <div class="setting-description">Lower quality uses less bandwidth</div>
      </div>
      <div style="flex-shrink: 0; margin-left: auto;">
        <select class="input-field" id="quality-select" style="width: 200px;">
          <option value="lowest" data-i18n="settings.lowest">–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ</option>
          <option value="160p">160p</option>
          <option value="360p">360p</option>
          <option value="480p">480p</option>
        </select>
      </div>
    </div>

    <div class="setting-item">
      <div class="setting-info">
        <div class="setting-label" data-i18n="settings.checkInterval">–ò–Ω—Ç–µ—Ä–≤–∞–ª –ø—Ä–æ–≤–µ—Ä–∫–∏ (–º–∏–Ω—É—Ç—ã)</div>
        <div class="setting-description">How often to check drop progress</div>
      </div>
      <div style="flex-shrink: 0; margin-left: auto;">
        <input type="number" class="input-field" id="interval-input" min="1" max="10" value="1" style="width: 100px;">
      </div>
    </div>

    <div class="setting-item">
      <div class="setting-info">
        <div class="setting-label" data-i18n="settings.preferredLanguage">–ü—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ–º—ã–π —è–∑—ã–∫ —Å—Ç—Ä–∏–º–æ–≤</div>
        <div class="setting-description">Prioritize streamers by language</div>
      </div>
      <div style="flex-shrink: 0; margin-left: auto;">
        <select class="input-field" id="stream-language-select" style="width: 200px;">
          <option value="russian" data-i18n="settings.russian">–†—É—Å—Å–∫–∏–π</option>
          <option value="english" data-i18n="settings.english">–ê–Ω–≥–ª–∏–π—Å–∫–∏–π</option>
          <option value="any" data-i18n="settings.any">–õ—é–±–æ–π</option>
        </select>
      </div>
    </div>
  </div>

  <!-- Shutdown Settings -->
  <div class="card">
    <h3 class="settings-section-title">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" style="margin-right: 8px; display: inline-block; vertical-align: -4px; color: #FF6B6B;">
        <path d="M13 3h-2v10h2V3zm4.83 2.17l-1.42 1.42C17.99 7.86 19 9.81 19 12c0 3.87-3.13 7-7 7s-7-3.13-7-7c0-2.19 1.01-4.14 2.58-5.42L6.17 5.17C4.23 6.82 3 9.26 3 12c0 4.97 4.03 9 9 9s9-4.03 9-9c0-2.74-1.23-5.18-3.17-6.83z"/>
      </svg>
      <span data-i18n="settings.shutdown">–í—ã–∫–ª—é—á–µ–Ω–∏–µ</span>
    </h3>
    
    <div class="setting-item">
      <div class="setting-info">
        <div class="setting-label" data-i18n="settings.enableShutdown">–í–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–≤—ã–∫–ª—é—á–µ–Ω–∏–µ</div>
        <div class="setting-description">Automatically shutdown after all drops are collected</div>
      </div>
      <label class="settings-toggle" for="shutdown-toggle">
        <input type="checkbox" id="shutdown-toggle">
        <span class="settings-slider"></span>
      </label>
    </div>

    <div class="setting-item" id="shutdown-action-setting" style="display: none;">
      <div class="setting-info">
        <div class="setting-label" data-i18n="settings.shutdownAction">–î–µ–π—Å—Ç–≤–∏–µ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è</div>
        <div class="setting-description">Choose what happens when farming completes</div>
      </div>
      <div style="flex-shrink: 0; margin-left: auto;">
        <select class="input-field" id="shutdown-action-select" style="width: 200px;">
          <option value="shutdown" data-i18n="settings.shutdownPC">–í—ã–∫–ª—é—á–∏—Ç—å –∫–æ–º–ø—å—é—Ç–µ—Ä</option>
          <option value="sleep" data-i18n="settings.sleep">–°–ø—è—â–∏–π —Ä–µ–∂–∏–º</option>
          <option value="hibernate" data-i18n="settings.hibernate">–ì–∏–±–µ—Ä–Ω–∞—Ü–∏—è</option>
        </select>
      </div>
    </div>
  </div>

  <!-- Advanced Settings -->
  <div class="card">
    <h3 class="settings-section-title">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" style="margin-right: 8px; display: inline-block; vertical-align: -4px; color: #A855F7;">
        <path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/>
      </svg>
      <span data-i18n="settings.advanced">–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ</span>
    </h3>
    
    <div class="setting-item">
      <div class="setting-info">
        <div class="setting-label" data-i18n="settings.enableLogging">–í–∫–ª—é—á–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ</div>
        <div class="setting-description">Save logs for debugging</div>
      </div>
      <label class="settings-toggle" for="logging-toggle">
        <input type="checkbox" id="logging-toggle">
        <span class="settings-slider"></span>
      </label>
    </div>

    <div class="setting-item">
      <div class="setting-info">
        <div class="setting-label" data-i18n="settings.clearCache">–û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à</div>
        <div class="setting-description">Clear all cached data and temporary files</div>
      </div>
      <button class="btn btn-secondary" id="clear-cache-btn">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path d="M3 6h18M8 6V4a2 2 0 012-2h4a2 2 0 012 2v2m3 0v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6h14z" stroke-width="2"/>
        </svg>
        Clear Cache
      </button>
    </div>
  </div>

  <!-- Updates -->
  <div class="card">
    <h3 class="settings-section-title">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" style="margin-right: 8px; display: inline-block; vertical-align: -4px; color: #3B82F6;">
        <path d="M12 16c1.01 0 1.91-.16 2.75-.46l-1.08-1.08c-.51.1-1.04.14-1.67.14-3.98 0-7.27-3.04-7.64-6.92h2.41l-3.26-4L0 7.62h2.21C2.52 12.08 6.82 16 12 16zm4.89-2.62l2.11 2.11-.9.9-2.11-2.11 .9-.9zM16.46 9c-.32 1.91-1.46 3.57-3.06 4.59l-1.01-1.01c1.06-.78 1.82-1.89 2.09-3.18l2.15-2.15-1.63-1.63 2.72-2.72 2.72 2.72-2.98 2.98z"/>
      </svg>
      <span>–û–±–Ω–æ–≤–ª–µ–Ω–∏—è</span>
    </h3>

    <div class="setting-item">
      <div class="setting-info">
        <div class="setting-label">–í–µ—Ä—Å–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</div>
        <div class="setting-description" id="app-version">‚Äî</div>
      </div>
      <button class="btn btn-secondary" id="check-updates-btn">
        –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
      </button>
    </div>
    
    <div class="setting-item" style="border-bottom: none;">
      <div class="setting-info">
        <div class="setting-label">–ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏</div>
        <div class="setting-description" style="display: flex; gap: 12px; margin-top: 8px; flex-wrap: wrap;">
          <a href="#" class="settings-link" data-link="https://github.com/Agrysif/WatchTwitch" style="display: flex; align-items: center; gap: 6px; color: var(--text-secondary); text-decoration: none; padding: 8px 14px; background: var(--bg-secondary); border-radius: 8px; border: 1px solid var(--border-color); transition: all 0.2s; font-size: 13px;">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
            </svg>
            GitHub
          </a>
          <a href="#" class="settings-link" data-link="https://t.me/watchtwitch_updates" style="display: flex; align-items: center; gap: 6px; color: var(--text-secondary); text-decoration: none; padding: 8px 14px; background: linear-gradient(135deg, rgba(36, 161, 222, 0.15), rgba(36, 161, 222, 0.05)); border-radius: 8px; border: 1px solid rgba(36, 161, 222, 0.3); transition: all 0.2s; font-size: 13px;">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" style="color: #24A1DE;">
              <path d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm5.562 8.161c-.18 1.897-.962 6.502-1.359 8.627-.168.9-.5 1.201-.82 1.23-.697.064-1.226-.461-1.901-.903-1.056-.692-1.653-1.123-2.678-1.799-1.185-.781-.417-1.21.258-1.911.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.139-5.062 3.345-.479.329-.913.489-1.302.481-.428-.009-1.252-.241-1.865-.44-.751-.244-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.831-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635.099-.002.321.023.465.141.121.099.154.232.17.326.016.094.036.308.02.475z"/>
            </svg>
            Telegram
          </a>
          <a href="#" class="settings-link" data-link="https://boosty.to/agrysif" style="display: flex; align-items: center; gap: 6px; color: var(--text-secondary); text-decoration: none; padding: 8px 14px; background: linear-gradient(135deg, rgba(255, 107, 0, 0.15), rgba(255, 107, 0, 0.05)); border-radius: 8px; border: 1px solid rgba(255, 107, 0, 0.3); transition: all 0.2s; font-size: 13px;">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" style="color: #FF6B00;">
              <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm.31-8.86c-1.77-.45-2.34-.94-2.34-1.67 0-.84.79-1.43 2.1-1.43 1.38 0 1.9.66 1.94 1.64h1.71c-.05-1.34-.87-2.57-2.49-2.97V5H10.9v1.69c-1.51.32-2.72 1.3-2.72 2.81 0 1.79 1.49 2.69 3.66 3.21 1.95.46 2.34 1.15 2.34 1.87 0 .53-.39 1.39-2.1 1.39-1.6 0-2.23-.72-2.32-1.64H8.04c.1 1.7 1.36 2.66 2.86 2.97V19h2.34v-1.67c1.52-.29 2.72-1.16 2.73-2.77-.01-2.2-1.9-2.96-3.66-3.42z"/>
            </svg>
            –ü–æ–¥–¥–µ—Ä–∂–∞—Ç—å
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- Save Button -->
  <div style="display: flex; justify-content: flex-end; margin-top: 24px;">
    <button class="btn btn-primary" id="save-settings-btn">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <path d="M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z" stroke-width="2"/>
        <path d="M17 21v-8H7v8M7 3v5h8" stroke-width="2"/>
      </svg>
      <span data-i18n="settings.save">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</span>
    </button>
  </div>
</div>

<style>
  .settings-section-title {
    font-size: 20px;
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 20px;
    padding-bottom: 12px;
    border-bottom: 1px solid var(--border-color);
  }

  .setting-item {
    display: flex;
    align-items: center;
    padding: 12px 0;
    border-bottom: 1px solid var(--border-color);
    gap: 12px;
  }

  .setting-item:last-child {
    border-bottom: none;
  }

  .setting-info {
    flex: 1;
    min-width: 0;
    display: flex;
    flex-direction: column;
    justify-content: center;
  }

  .setting-item > div[style*="flex-shrink"] {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .setting-label {
    font-size: 16px;
    font-weight: 500;
    color: var(--text-primary);
    margin-bottom: 4px;
  }

  .setting-description {
    font-size: 14px;
    color: var(--text-secondary);
  }

  /* Settings Toggle Styles */
  .settings-toggle {
    position: relative;
    display: inline-block;
    width: 44px;
    height: 24px;
    flex-shrink: 0;
    cursor: pointer;
    overflow: hidden;
  }

  .settings-toggle input {
    opacity: 0;
    width: 0;
    height: 0;
    position: absolute;
  }

  .settings-slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: rgba(255, 255, 255, 0.1);
    transition: all 0.3s ease;
    border-radius: 24px;
    border: 1px solid rgba(255, 255, 255, 0.2);
  }

  .settings-slider::before {
    content: '';
    position: absolute;
    height: 18px;
    width: 18px;
    left: 3px;
    bottom: 2px;
    background-color: white;
    transition: all 0.3s ease;
    border-radius: 50%;
  }

  .settings-toggle input:checked + .settings-slider {
    background-color: var(--accent-color);
    border-color: var(--accent-color);
  }

  .settings-toggle input:checked + .settings-slider::before {
    transform: translateX(20px);
  }

  .settings-toggle:hover .settings-slider {
    box-shadow: 0 0 8px rgba(145, 71, 255, 0.3);
  }
</style>

<script>
  class SettingsPage {
    constructor() {
      console.log('SettingsPage constructor called');
      this.settings = null;
      this.init();
    }

    async init() {
      console.log('SettingsPage init called');
      await this.loadSettings();
      console.log('Settings loaded:', this.settings);
      this.setupEventListeners();
      this.applySettings();
      this.loadAppVersion();
      console.log('SettingsPage init complete');
    }

    async loadSettings() {
      this.settings = await Storage.getSettings();
    }

    applySettings() {
      // Language
      document.getElementById('language-select').value = this.settings.language;
      
      // Theme
      document.getElementById('theme-select').value = this.settings.theme;
      
      // Toggles - now checkbox based
      this.setCheckbox('autostart-toggle', this.settings.autostart);
      this.setCheckbox('notifications-toggle', this.settings.notifications);
      this.setCheckbox('sound-toggle', this.settings.soundAlerts);
      this.setCheckbox('shutdown-toggle', this.settings.enableShutdown);
      this.setCheckbox('logging-toggle', this.settings.enableLogging);
      
      // Other fields
      document.getElementById('quality-select').value = this.settings.streamQuality;
      document.getElementById('interval-input').value = this.settings.checkInterval;
      document.getElementById('stream-language-select').value = this.settings.preferredLanguage;
      document.getElementById('shutdown-action-select').value = this.settings.shutdownAction;

      // Show/hide shutdown action
      if (this.settings.enableShutdown) {
        document.getElementById('shutdown-action-setting').style.display = 'flex';
      }
    }

    setCheckbox(id, checked) {
      const checkbox = document.getElementById(id);
      if (!checkbox) {
        console.error(`Cannot set checkbox ${id} - not found`);
        return;
      }
      checkbox.checked = checked;
    }

    setupEventListeners() {
      // Theme change
      document.getElementById('theme-select').addEventListener('change', (e) => {
        document.body.className = `theme-${e.target.value}`;
      });

      // Language change
      document.getElementById('language-select').addEventListener('change', (e) => {
        i18n.setLanguage(e.target.value);
      });

      // Shutdown toggle - show/hide action selector
      document.getElementById('shutdown-toggle').addEventListener('change', (e) => {
        const actionSetting = document.getElementById('shutdown-action-setting');
        if (e.target.checked) {
          actionSetting.style.display = 'flex';
        } else {
          actionSetting.style.display = 'none';
        }
      });
      
      // External links
      document.querySelectorAll('.settings-link').forEach(link => {
        link.addEventListener('click', (e) => {
          e.preventDefault();
          const url = link.getAttribute('data-link');
          if (window.electronAPI?.openExternal) {
            window.electronAPI.openExternal(url);
          }
        });
        
        // Hover effect
        link.addEventListener('mouseenter', () => {
          link.style.transform = 'translateY(-2px)';
          link.style.boxShadow = '0 4px 12px rgba(145, 71, 255, 0.2)';
        });
        link.addEventListener('mouseleave', () => {
          link.style.transform = 'translateY(0)';
          link.style.boxShadow = 'none';
        });
      });

      // Save button
      document.getElementById('save-settings-btn').addEventListener('click', () => {
        this.saveSettings();
      });

      // Clear cache
      document.getElementById('clear-cache-btn').addEventListener('click', () => {
        this.clearCache();
      });

      // Check updates
      const checkUpdatesBtn = document.getElementById('check-updates-btn');
      if (checkUpdatesBtn) {
        checkUpdatesBtn.addEventListener('click', () => {
          if (window.electronAPI?.checkForUpdates) {
            window.electronAPI.checkForUpdates();
            window.utils.showToast('üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è...', 'info');
          } else {
            window.utils.showToast('–û–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã –≤ —ç—Ç–æ–º —Ä–µ–∂–∏–º–µ', 'warning');
          }
        });
      }
    }

    async loadAppVersion() {
      const versionEl = document.getElementById('app-version');
      if (!versionEl) return;
      try {
        if (window.electronAPI?.getAppVersion) {
          const version = await window.electronAPI.getAppVersion();
          versionEl.textContent = `v${version}`;
        } else {
          versionEl.textContent = '‚Äî';
        }
      } catch (e) {
        versionEl.textContent = '‚Äî';
      }
    }

    async saveSettings() {
      this.settings = {
        language: document.getElementById('language-select').value,
        theme: document.getElementById('theme-select').value,
        autostart: document.getElementById('autostart-toggle').checked,
        notifications: document.getElementById('notifications-toggle').checked,
        soundAlerts: document.getElementById('sound-toggle').checked,
        streamQuality: document.getElementById('quality-select').value,
        checkInterval: parseInt(document.getElementById('interval-input').value),
        preferredLanguage: document.getElementById('stream-language-select').value,
        enableShutdown: document.getElementById('shutdown-toggle').checked,
        shutdownAction: document.getElementById('shutdown-action-select').value,
        enableLogging: document.getElementById('logging-toggle').checked
      };

      await Storage.saveSettings(this.settings);
      
      // Apply autostart
      window.electronAPI.setAutostart(this.settings.autostart);

      window.utils.showToast('Settings saved successfully!', 'success');
    }

    async clearCache() {
      if (confirm('Are you sure you want to clear all cache data?')) {
        // Clear specific cache items
        // This is a placeholder - implement actual cache clearing
        window.utils.showToast('Cache cleared', 'success');
      }
    }
  }

  window.SettingsPage = SettingsPage;
</script>
